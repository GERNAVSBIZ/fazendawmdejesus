<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gado Pro Mobile v19 - Sistema Completo</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { -webkit-tap-highlight-color: transparent; }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }

        @media (max-width: 768px) {
            #menu-desktop { display: none; }
            #menu-mobile { display: flex; }
            #conteudo-principal { padding-bottom: 90px; }
            .filter-grid { grid-template-columns: repeat(2, 1fr); }
        }
        @media (min-width: 769px) {
            #menu-desktop { display: flex; }
            #menu-mobile { display: none; }
            .filter-grid { grid-template-columns: repeat(4, 1fr); }
        }
        .tab-btn.active { background-color: #1e293b; color: white; border-color: #1e293b; }
        .tab-btn { background-color: white; color: #64748b; border: 1px solid #e2e8f0; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans text-slate-800 select-none">

    <nav id="menu-desktop" class="bg-slate-900 text-white px-6 py-4 shadow-lg sticky top-0 z-50 justify-between items-center">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center shadow-lg"><i class="fas fa-cow text-lg"></i></div>
            <div><h1 class="text-xl font-bold tracking-tight">GADO PRO</h1><p class="text-[10px] text-slate-400 font-medium">MOBILE v19.0</p></div>
        </div>
        <div class="flex gap-2 text-sm font-medium">
            <button onclick="nav('dashboard')" class="px-4 py-2 rounded-lg hover:bg-white/10 transition flex items-center gap-2"><i class="fas fa-chart-line"></i> Painel</button>
            <button onclick="nav('lista')" class="px-4 py-2 rounded-lg hover:bg-white/10 transition flex items-center gap-2"><i class="fas fa-list"></i> Rebanho</button>
            <button onclick="nav('cadastro')" class="px-4 py-2 rounded-lg hover:bg-white/10 transition flex items-center gap-2"><i class="fas fa-plus"></i> Novo</button>
            <button onclick="nav('exportar')" class="px-4 py-2 rounded-lg bg-green-700 hover:bg-green-600 shadow transition flex items-center gap-2"><i class="fas fa-file-export"></i> Dados</button>
        </div>
    </nav>

    <div id="conteudo-principal" class="max-w-7xl mx-auto p-4 md:p-6 w-full relative">
        
        <div id="tela-dashboard" class="space-y-6 fade-in">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-6">
                <div class="bg-white p-4 rounded-xl shadow-sm border-b-4 border-slate-600 flex flex-col justify-between">
                    <div><p class="text-[10px] font-bold text-slate-400 uppercase">Total Ativo</p><p class="text-2xl md:text-4xl font-extrabold text-slate-800 mt-1" id="kpi-total">0</p></div>
                    <div class="mt-2 pt-2 border-t border-slate-100 flex justify-between text-[10px] font-bold text-gray-500" id="kpi-detalhe-total"><span><i class="fas fa-mars text-blue-500"></i> -</span><span><i class="fas fa-venus text-pink-500"></i> -</span></div>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border-b-4 border-green-500 flex flex-col justify-between">
                    <div><p class="text-[10px] font-bold text-slate-400 uppercase">Lactação</p><div class="flex items-baseline gap-1 mt-1"><p class="text-2xl md:text-4xl font-extrabold text-green-600" id="kpi-lactacao">0</p><span class="text-[10px] font-bold text-green-600 bg-green-100 px-1.5 py-0.5 rounded-full" id="pct-lactacao">0%</span></div></div>
                    <div class="mt-2 pt-2 border-t border-slate-100 text-[10px] font-bold text-green-600">Produzindo</div>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border-b-4 border-blue-500 flex flex-col justify-between">
                    <div><p class="text-[10px] font-bold text-slate-400 uppercase">Bezerros (< 1 ano)</p><p class="text-2xl md:text-4xl font-extrabold text-blue-600 mt-1" id="kpi-bezerros">0</p></div>
                    <div class="mt-2 pt-2 border-t border-slate-100 flex justify-between text-[10px] font-bold text-gray-500" id="kpi-detalhe-bezerros"><span><i class="fas fa-mars text-blue-500"></i> -</span><span><i class="fas fa-venus text-pink-500"></i> -</span></div>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border-b-4 border-red-500 flex flex-col justify-between">
                    <div><p class="text-[10px] font-bold text-slate-400 uppercase">Alertas</p><p class="text-2xl md:text-4xl font-extrabold text-red-500 mt-1 animate-pulse" id="kpi-alertas">0</p></div>
                    <div class="mt-2 pt-2 border-t border-slate-100 text-[10px] font-bold text-red-500">Secagem Pendente</div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6">
                <div class="bg-white p-4 rounded-xl shadow-sm lg:col-span-1 border border-slate-100">
                    <h3 class="font-bold text-slate-700 mb-4 text-sm flex items-center gap-2"><i class="fas fa-chart-pie text-slate-400"></i> Status</h3>
                    <div class="h-48 md:h-64 relative flex items-center justify-center"><canvas id="chartStatus"></canvas><div id="chart-msg" class="absolute text-xs text-gray-400 hidden">Sem dados</div></div>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm lg:col-span-2 border border-slate-100">
                    <h3 class="font-bold text-slate-700 mb-4 text-sm flex items-center gap-2"><i class="fas fa-chart-bar text-slate-400"></i> Nascimentos (12 meses)</h3>
                    <div class="h-48 md:h-64"><canvas id="chartNascimentos"></canvas></div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                <div class="p-4 bg-slate-50 border-b border-slate-100 flex flex-col md:flex-row justify-between md:items-center gap-3">
                    <div><h3 class="font-bold text-slate-700 text-sm flex items-center gap-2"><i class="fas fa-stopwatch text-slate-400"></i> Cronograma</h3><p class="text-xs text-gray-400 mt-1">Tempo em Produção/Seca</p></div>
                    <div class="flex gap-2">
                        <select id="filtro-crono-status" onchange="atualizarCronograma()" class="border border-gray-200 rounded-lg text-xs py-1.5 px-2 bg-white text-slate-600 focus:border-blue-500"><option value="ALL">Todos</option><option value="LACTAÇÃO">Em Lactação</option><option value="SECA">Secas</option></select>
                        <select id="filtro-crono-ordem" onchange="atualizarCronograma()" class="border border-gray-200 rounded-lg text-xs py-1.5 px-2 bg-white text-slate-600 focus:border-blue-500"><option value="DESC">Mais Dias</option><option value="ASC">Menos Dias</option></select>
                    </div>
                </div>
                <div class="overflow-x-auto max-h-96">
                    <table class="w-full text-sm text-left whitespace-nowrap">
                        <thead class="bg-slate-50 text-slate-400 text-[10px] uppercase font-bold sticky top-0"><tr><th class="px-4 py-3">Animal</th><th class="px-4 py-3">Status</th><th class="px-4 py-3 text-right">Duração</th></tr></thead>
                        <tbody id="lista-cronograma" class="divide-y divide-slate-50 text-slate-600"></tbody>
                    </table>
                    <div id="crono-msg" class="hidden p-4 text-center text-xs text-gray-400">Nenhum animal.</div>
                </div>
            </div>
        </div>

        <div id="tela-lista" class="hidden space-y-4 fade-in">
            <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                <div class="grid filter-grid gap-3">
                    <div class="relative col-span-2 md:col-span-1"><i class="fas fa-search absolute left-3 top-3 text-gray-400 text-xs"></i><input type="text" id="filtro-busca" onkeyup="aplicarFiltros()" placeholder="Buscar ID..." class="w-full pl-8 pr-2 py-2 border border-gray-200 rounded-lg text-sm bg-slate-50 focus:border-blue-500 outline-none"></div>
                    <div><select id="filtro-sexo" onchange="aplicarFiltros()" class="w-full py-2 px-2 border border-gray-200 rounded-lg text-sm bg-slate-50 text-slate-600 focus:border-blue-500 outline-none"><option value="ALL">Sexo: Todos</option><option value="FEMEA">Fêmeas</option><option value="MACHO">Machos</option></select></div>
                    <div><select id="filtro-status" onchange="aplicarFiltros()" class="w-full py-2 px-2 border border-gray-200 rounded-lg text-sm bg-slate-50 text-slate-600 focus:border-blue-500 outline-none"><option value="ALL">Status: Todos</option><option value="LACTACAO">Em Lactação</option><option value="SECA">Secas</option><option value="OUTROS">Outros</option></select></div>
                    <div><select id="filtro-cat" onchange="aplicarFiltros()" class="w-full py-2 px-2 border border-gray-200 rounded-lg text-sm bg-slate-50 text-slate-600 focus:border-blue-500 outline-none"><option value="ALL">Categoria: Todas</option><option value="BEZERRO">Bezerros</option><option value="ADULTO">Adultos</option></select></div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                <div class="overflow-x-auto hide-scroll">
                    <table class="w-full text-left border-collapse whitespace-nowrap">
                        <thead><tr class="text-[10px] font-bold text-slate-400 uppercase bg-slate-50 border-b border-slate-100"><th class="px-4 py-3">ID</th><th class="px-4 py-3 text-center">Sexo</th><th class="px-4 py-3">Status</th><th class="px-4 py-3">Ref. Data</th><th class="px-4 py-3 w-40 text-center">Ações</th></tr></thead>
                        <tbody id="tbody-lista" class="text-sm text-slate-600 divide-y divide-slate-50"></tbody>
                    </table>
                    <div id="sem-resultados" class="hidden p-6 text-center text-gray-400 text-sm">Nenhum animal encontrado.</div>
                </div>
            </div>
        </div>

        <div id="tela-exportar" class="hidden max-w-lg mx-auto fade-in">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 mb-6 text-center">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 text-green-600"><i class="fas fa-file-csv text-2xl"></i></div>
                <h2 class="font-bold text-slate-800">Backup dos Dados</h2>
                <button onclick="exportarDados()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-xl mt-4 shadow-lg shadow-green-200"><i class="fas fa-download mr-2"></i> Baixar CSV Completo</button>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 mb-6">
                <h3 class="font-bold text-slate-700 mb-2 text-center flex items-center justify-center gap-2"><i class="fas fa-cloud-upload-alt text-blue-500"></i> Restaurar Sistema</h3>
                <p class="text-xs text-center text-gray-400 mb-4">Use o CSV gerado pelo botão acima para restaurar.</p>
                <div class="p-4 border-2 border-dashed border-blue-200 rounded-xl hover:bg-blue-50 transition relative text-center">
                    <i class="fas fa-file-import text-blue-400 text-2xl mb-2"></i>
                    <p class="text-xs font-bold text-blue-600">Toque para selecionar Backup (CSV)</p>
                    <input type="file" id="fileBackupCompleto" class="absolute inset-0 opacity-0 cursor-pointer" onchange="importarBackupCompleto()">
                </div>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 mb-6 opacity-80">
                <h3 class="font-bold text-slate-700 mb-4 text-center text-sm">Importar Dados Parciais</h3>
                <div class="space-y-3">
                    <div class="p-3 border border-dashed rounded hover:border-pink-400 relative"><span class="text-xs font-bold text-pink-500">RG FÊMEA</span><input type="file" id="fileFemea" class="absolute inset-0 opacity-0" onchange="importarCSV('FEMEA')"></div>
                    <div class="p-3 border border-dashed rounded hover:border-blue-400 relative"><span class="text-xs font-bold text-blue-500">RG MACHO</span><input type="file" id="fileMacho" class="absolute inset-0 opacity-0" onchange="importarCSV('MACHO')"></div>
                    <div class="p-3 border border-dashed rounded hover:border-green-400 relative"><span class="text-xs font-bold text-green-500">NASCIMENTO</span><input type="file" id="fileNasc" class="absolute inset-0 opacity-0" onchange="importarCSV('NASCIMENTO')"></div>
                </div>
            </div>

            <div class="bg-red-50 p-6 rounded-2xl border border-red-100 text-center">
                <h3 class="font-bold text-red-800 mb-2"><i class="fas fa-exclamation-triangle"></i> Zona de Perigo</h3>
                <p class="text-xs text-red-600 mb-4">Isso apaga TODOS os dados permanentemente.</p>
                <button onclick="zerarBancoDeDados()" class="w-full bg-white border border-red-200 text-red-600 hover:bg-red-600 hover:text-white font-bold py-3 rounded-xl transition text-sm">ZERAR BANCO DE DADOS</button>
            </div>
            
            <p id="import-status" class="text-xs text-blue-500 font-bold mt-4 text-center h-4"></p>
        </div>

        <div id="tela-cadastro" class="hidden max-w-lg mx-auto fade-in mt-4 md:mt-10">
            <div class="flex gap-2 mb-4">
                <button onclick="switchCadastro('nasc')" id="tab-nasc" class="tab-btn active flex-1 py-3 rounded-xl text-sm font-bold shadow-sm transition"><i class="fas fa-baby mr-1"></i> Nascimento</button>
                <button onclick="switchCadastro('adulto')" id="tab-adulto" class="tab-btn flex-1 py-3 rounded-xl text-sm font-bold shadow-sm transition"><i class="fas fa-cow mr-1"></i> Adulto/Compra</button>
            </div>
            <div id="box-nasc" class="bg-white rounded-2xl shadow-sm p-6 border border-gray-100">
                <form id="formNascimento" class="space-y-4">
                    <div><label class="block text-xs font-bold text-gray-400 mb-1">ID Bezerro</label><input type="text" id="cad-idBezerro" class="w-full border p-3 rounded-xl bg-gray-50" required></div>
                    <div><label class="block text-xs font-bold text-gray-400 mb-1">Data Parto</label><input type="date" id="cad-data" class="w-full border p-3 rounded-xl bg-gray-50" required></div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-xs font-bold text-gray-400 mb-1">Sexo Bezerro</label><select id="cad-sexo" class="w-full border p-3 rounded-xl bg-gray-50"><option value="MACHO">Macho</option><option value="FEMEA">Fêmea</option></select></div>
                        <div><label class="block text-xs font-bold text-gray-400 mb-1">ID Mãe</label><input type="text" id="cad-idMae" class="w-full border p-3 rounded-xl bg-gray-50" required></div>
                    </div>
                    <button type="submit" class="w-full bg-slate-800 text-white font-bold py-3.5 rounded-xl mt-2">SALVAR NASCIMENTO</button>
                </form>
            </div>
            <div id="box-adulto" class="hidden bg-white rounded-2xl shadow-sm p-6 border border-gray-100">
                <form id="formAdulto" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-xs font-bold text-gray-400 mb-1">ID Animal</label><input type="text" id="adulto-id" class="w-full border p-3 rounded-xl bg-gray-50" required></div>
                        <div><label class="block text-xs font-bold text-gray-400 mb-1">Data Entrada</label><input type="date" id="adulto-data" class="w-full border p-3 rounded-xl bg-gray-50" required></div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-xs font-bold text-gray-400 mb-1">Sexo</label><select id="adulto-sexo" class="w-full border p-3 rounded-xl bg-gray-50"><option value="FEMEA">Fêmea</option><option value="MACHO">Macho</option></select></div>
                        <div><label class="block text-xs font-bold text-gray-400 mb-1">Status</label><select id="adulto-status" class="w-full border p-3 rounded-xl bg-gray-50"><option value="LACTAÇÃO">Em Lactação</option><option value="SECA">Seca</option><option value="ATIVO">Ativo</option></select></div>
                    </div>
                    <div><label class="block text-xs font-bold text-gray-400 mb-1">Obs</label><input type="text" id="adulto-obs" class="w-full border p-3 rounded-xl bg-gray-50"></div>
                    <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3.5 rounded-xl mt-2">SALVAR ANIMAL</button>
                </form>
            </div>
        </div>

        <div id="modal-secagem" class="hidden fixed inset-0 bg-slate-900/80 z-[60] flex items-center justify-center p-4 backdrop-blur-sm"><div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-sm fade-in"><h3 class="text-lg font-bold text-slate-800 mb-2">Encerrar Lactação</h3><p class="text-sm text-gray-500 mb-4">Vaca: <strong id="lbl-id-vaca-sec" class="text-blue-600"></strong></p><input type="hidden" id="input-id-secagem"><label class="block text-xs font-bold text-gray-400 uppercase mb-1">Data Secagem</label><input type="date" id="input-data-secagem" class="w-full border p-3 rounded-xl mb-4 text-base bg-slate-50"><div class="flex gap-3"><button onclick="document.getElementById('modal-secagem').classList.add('hidden')" class="w-1/2 py-3 bg-gray-100 rounded-xl text-sm font-bold">Cancelar</button><button onclick="confirmarSecagem()" class="w-1/2 py-3 bg-red-600 text-white rounded-xl text-sm font-bold">Confirmar</button></div></div></div>
        <div id="modal-editar" class="hidden fixed inset-0 bg-slate-900/80 z-[60] flex items-center justify-center p-4 backdrop-blur-sm"><div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-sm fade-in"><h3 class="text-lg font-bold text-slate-800 mb-4">Trocar Brinco</h3><input type="hidden" id="edit-id-antigo"><div class="mb-3"><label class="text-xs font-bold text-gray-400">Atual</label><input type="text" id="view-id-antigo" disabled class="w-full border p-3 rounded-xl bg-gray-100"></div><div class="mb-6"><label class="text-xs font-bold text-gray-400">Novo</label><input type="text" id="edit-id-novo" class="w-full border-2 border-blue-100 p-3 rounded-xl font-bold text-lg"></div><div class="flex gap-3"><button onclick="document.getElementById('modal-editar').classList.add('hidden')" class="w-1/2 py-3 bg-gray-100 rounded-xl font-bold text-sm">Cancelar</button><button onclick="confirmarEdicao()" class="w-1/2 py-3 bg-blue-600 text-white rounded-xl font-bold text-sm">Salvar</button></div></div></div>
        <div id="modal-excluir" class="hidden fixed inset-0 bg-slate-900/80 z-[60] flex items-center justify-center p-4 backdrop-blur-sm"><div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-sm fade-in border-t-4 border-red-500"><h3 class="text-lg font-bold text-slate-800 mb-2">Dar Baixa</h3><input type="hidden" id="input-id-excluir"><div class="space-y-3 mb-6"><select id="input-motivo-excluir" class="w-full border p-3 rounded-xl bg-slate-50"><option value="VENDIDO">Venda</option><option value="MORTO">Morte</option><option value="ROUBO">Roubo</option><option value="OUTRO">Outro</option></select><input type="date" id="input-data-excluir" class="w-full border p-3 rounded-xl"><input type="text" id="input-obs-excluir" class="w-full border p-3 rounded-xl" placeholder="Obs..."></div><div class="flex gap-3"><button onclick="document.getElementById('modal-excluir').classList.add('hidden')" class="w-1/2 py-3 bg-gray-100 rounded-xl font-bold text-sm">Cancelar</button><button onclick="confirmarExclusao()" class="w-1/2 py-3 bg-red-600 text-white rounded-xl font-bold text-sm">Baixar</button></div></div></div>
        <div id="modal-dossie" class="hidden fixed inset-0 bg-white z-[70] flex flex-col fade-in"><div class="bg-slate-50 p-4 border-b border-gray-200 flex justify-between items-center shadow-sm sticky top-0 z-10"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-sm border border-gray-100 text-lg text-blue-600"><i class="fas fa-id-card"></i></div><div><h2 class="text-xl font-bold text-slate-800" id="dossie-id">---</h2><div class="text-[10px] text-gray-500" id="dossie-resumo"></div></div></div><button onclick="fecharDossie()" class="w-8 h-8 rounded-full bg-gray-200 text-gray-600 flex justify-center items-center"><i class="fas fa-times"></i></button></div><div class="flex-grow overflow-y-auto p-4 bg-slate-50 space-y-6"><div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100"><div class="space-y-3"><input type="date" id="dossie-nova-data" class="w-full border p-3 rounded-lg text-sm bg-gray-50"><textarea id="dossie-nova-obs" class="w-full border p-3 rounded-lg text-sm bg-gray-50 h-20 resize-none" placeholder="Ocorrência..."></textarea><button onclick="salvarOcorrencia()" class="w-full bg-blue-600 text-white py-3 rounded-lg text-sm font-bold shadow-md">Salvar</button></div></div><div><div class="space-y-4 pl-2" id="dossie-timeline"></div></div></div></div>

    </div>

    <div id="menu-mobile" class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-6 py-2 flex justify-between items-center z-50 shadow-[0_-5px_15px_rgba(0,0,0,0.05)]">
        <button onclick="nav('dashboard')" class="flex flex-col items-center p-2 text-gray-400 hover:text-blue-600 transition nav-item-mob" id="mob-dashboard"><i class="fas fa-chart-pie text-xl mb-1"></i><span class="text-[10px] font-bold">Painel</span></button>
        <button onclick="nav('lista')" class="flex flex-col items-center p-2 text-gray-400 hover:text-blue-600 transition nav-item-mob" id="mob-lista"><i class="fas fa-list text-xl mb-1"></i><span class="text-[10px] font-bold">Rebanho</span></button>
        <button onclick="nav('cadastro')" class="flex flex-col items-center -mt-8"><div class="w-14 h-14 bg-slate-900 rounded-full flex items-center justify-center text-white shadow-lg shadow-slate-400 border-4 border-gray-50 active:scale-95 transition"><i class="fas fa-plus text-xl"></i></div></button>
        <button onclick="nav('exportar')" class="flex flex-col items-center p-2 text-gray-400 hover:text-blue-600 transition nav-item-mob" id="mob-exportar"><i class="fas fa-file-export text-xl mb-1"></i><span class="text-[10px] font-bold">Dados</span></button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, doc, writeBatch, getDocs, setDoc, addDoc, query, where, getDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CREDENCIAIS
        const firebaseConfig = {
            apiKey: "AIzaSyDT93mKi2kTXKLxdQngup6D-czdu9_vTYk",
            authDomain: "registro-animais.firebaseapp.com",
            projectId: "registro-animais",
            storageBucket: "registro-animais.firebasestorage.app",
            messagingSenderId: "343289114136",
            appId: "1:343289114136:web:d98ed164d8bbd3f7b9dd6d"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.todosAnimais = [];
        window.cronogramaGlobal = [];

        window.nav = (tela) => {
            ['dashboard', 'cadastro', 'lista', 'exportar'].forEach(t => document.getElementById('tela-' + t).classList.add('hidden'));
            document.getElementById('tela-' + tela).classList.remove('hidden');
            document.querySelectorAll('.nav-item-mob').forEach(b => b.classList.remove('text-blue-600'));
            if(document.getElementById('mob-'+tela)) document.getElementById('mob-'+tela).classList.add('text-blue-600');
            if(tela === 'dashboard' || tela === 'lista') carregarDados();
        }

        window.switchCadastro = (tipo) => {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-' + tipo).classList.add('active');
            document.getElementById('box-nasc').classList.add('hidden');
            document.getElementById('box-adulto').classList.add('hidden');
            document.getElementById('box-' + tipo).classList.remove('hidden');
        }

        async function carregarDados() {
            try {
                const snap = await getDocs(collection(db, 'animais'));
                let animais = [];
                snap.forEach(d => animais.push(d.data()));

                const limpar = (str) => str ? str.toString().toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim() : "";
                window.todosAnimais = animais.filter(a => { const st = limpar(a.status_produtivo); return !st.includes('VENDIDO') && !st.includes('MORTO') && !st.includes('ROUBO'); });

                if (!document.getElementById('tela-dashboard').classList.contains('hidden')) {
                    const lactacao = window.todosAnimais.filter(a => limpar(a.status_produtivo).includes('LACTA'));
                    const secas = window.todosAnimais.filter(a => limpar(a.status_produtivo).includes('SECA'));
                    const bezerros = window.todosAnimais.filter(a => a.nascimento ? calcularMeses(a.nascimento) < 12 : limpar(a.categoria_manual).includes('BEZERRO'));
                    
                    const totalM = window.todosAnimais.filter(a => a.tipo === 'MACHO').length;
                    const totalF = window.todosAnimais.filter(a => a.tipo === 'FEMEA').length;
                    const bezM = bezerros.filter(a => a.tipo === 'MACHO').length;
                    const bezF = bezerros.filter(a => a.tipo === 'FEMEA').length;

                    document.getElementById('kpi-total').innerText = window.todosAnimais.length;
                    document.getElementById('kpi-detalhe-total').innerHTML = `<span class="text-blue-500"><i class="fas fa-mars"></i> ${totalM}</span><span class="text-pink-500"><i class="fas fa-venus"></i> ${totalF}</span>`;
                    document.getElementById('kpi-lactacao').innerText = lactacao.length;
                    document.getElementById('pct-lactacao').innerText = window.todosAnimais.length ? Math.round((lactacao.length / window.todosAnimais.length)*100) + '%' : '0%';
                    document.getElementById('kpi-bezerros').innerText = bezerros.length;
                    document.getElementById('kpi-detalhe-bezerros').innerHTML = `<span class="text-blue-500"><i class="fas fa-mars"></i> ${bezM}</span><span class="text-pink-500"><i class="fas fa-venus"></i> ${bezF}</span>`;
                    
                    const alertas = []; const cronograma = []; const hoje = new Date();
                    
                    lactacao.forEach(a => {
                        let dias = 0; let strDias = "Data N/D";
                        if(a.data_evento) {
                            dias = Math.floor((hoje - new Date(a.data_evento)) / 86400000);
                            strDias = dias + " dias";
                            if(dias > 300) alertas.push({id: a.id, dias: dias});
                        }
                        cronograma.push({id: a.id, status: 'LACTAÇÃO', diasNum: dias, diasStr: strDias});
                    });
                    
                    secas.forEach(a => {
                        let dias = 0; let strDias = "Data N/D";
                        if(a.data_evento) {
                            dias = Math.floor((hoje - new Date(a.data_evento)) / 86400000);
                            strDias = dias + " dias";
                        }
                        cronograma.push({id: a.id, status: 'SECA', diasNum: dias, diasStr: strDias});
                    });

                    window.cronogramaGlobal = cronograma;
                    document.getElementById('kpi-alertas').innerText = alertas.length;
                    atualizarCronograma();
                    renderCharts(lactacao.length, window.todosAnimais.length - lactacao.length, window.todosAnimais.length, bezerros);
                }
                if (!document.getElementById('tela-lista').classList.contains('hidden')) aplicarFiltros();
            } catch(e) { console.error(e); }
        }

        window.atualizarCronograma = () => {
            if (!window.cronogramaGlobal) return;
            const filtroStatus = document.getElementById('filtro-crono-status').value;
            const filtroOrdem = document.getElementById('filtro-crono-ordem').value;
            let lista = window.cronogramaGlobal.filter(c => {
                const stClean = c.status.toUpperCase().includes('LACTA') ? 'LACTAÇÃO' : 'SECA';
                if(filtroStatus === 'ALL') return true;
                return stClean === filtroStatus;
            });
            lista.sort((a,b) => filtroOrdem === 'DESC' ? b.diasNum - a.diasNum : a.diasNum - b.diasNum);
            const tbl = document.getElementById('lista-cronograma'); tbl.innerHTML = '';
            if(lista.length === 0) { document.getElementById('crono-msg').classList.remove('hidden'); } else { document.getElementById('crono-msg').classList.add('hidden'); lista.forEach(c => { let cor = c.status === 'LACTAÇÃO' ? 'text-green-600 bg-green-50' : 'text-red-500 bg-red-50'; tbl.innerHTML += `<tr class="hover:bg-slate-50 border-b border-slate-50"><td class="px-4 py-3 font-bold text-slate-700">${c.id}</td><td class="px-4 py-3"><span class="text-[10px] font-bold px-2 py-1 rounded-full ${cor}">${c.status}</span></td><td class="px-4 py-3 text-right font-mono text-slate-500">${c.diasStr}</td></tr>`; }); }
        }

        window.aplicarFiltros = () => {
            const fBusca = document.getElementById('filtro-busca').value.toUpperCase();
            const fSexo = document.getElementById('filtro-sexo').value;
            const fStatus = document.getElementById('filtro-status').value;
            const fCat = document.getElementById('filtro-cat').value;
            const limpar = (str) => str ? str.toString().toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim() : "";
            
            const tbody = document.getElementById('tbody-lista'); tbody.innerHTML = ''; let count = 0;
            const lista = window.todosAnimais.filter(a => {
                if (fBusca && !a.id.includes(fBusca)) return false;
                if (fSexo !== 'ALL' && a.tipo !== fSexo) return false;
                const st = limpar(a.status_produtivo);
                if (fStatus === 'LACTACAO' && !st.includes('LACTACAO')) return false;
                if (fStatus === 'SECA' && !st.includes('SECA')) return false;
                if (fStatus === 'OUTROS' && (st.includes('LACTACAO') || st.includes('SECA'))) return false;
                const ehBez = a.nascimento ? calcularMeses(a.nascimento) < 12 : limpar(a.categoria_manual).includes('BEZERRO');
                if (fCat === 'BEZERRO' && !ehBez) return false;
                if (fCat === 'ADULTO' && ehBez) return false;
                return true;
            });

            lista.sort((a,b) => a.id.localeCompare(b.id, undefined, {numeric: true})).slice(0, 300).forEach(a => {
                count++;
                const st = limpar(a.status_produtivo);
                let badge = `<span class="text-[9px] font-bold text-gray-400 bg-gray-100 px-1.5 py-0.5 rounded">OUT</span>`;
                let slotSecar = `<div class="w-8 h-8"></div>`;
                if(st.includes('LACTACAO')) {
                    badge = `<span class="text-[9px] font-bold text-green-600 bg-green-50 px-1.5 py-0.5 rounded border border-green-100">LACT</span>`;
                    slotSecar = `<button onclick="abrirModalSecagem('${a.id}')" class="w-8 h-8 rounded-full flex items-center justify-center text-gray-300 hover:text-yellow-500 hover:bg-yellow-50 transition border border-gray-100 bg-white shadow-sm"><i class="fas fa-power-off text-xs"></i></button>`;
                } else if (st.includes('SECA')) badge = `<span class="text-[9px] font-bold text-red-400 bg-red-50 px-1.5 py-0.5 rounded border border-red-100">SECA</span>`;
                let sexIcon = a.tipo === 'MACHO' ? '<i class="fas fa-mars text-blue-500"></i>' : '<i class="fas fa-venus text-pink-500"></i>';
                tbody.innerHTML += `<tr class="hover:bg-slate-50 transition border-b border-slate-50"><td class="px-4 py-3 font-bold text-slate-700">${a.id}</td><td class="px-4 py-3 text-center">${sexIcon}</td><td class="px-4 py-3">${badge}</td><td class="px-4 py-3 text-xs text-gray-400 font-mono">${formatarDataBr(a.data_evento || a.nascimento)}</td><td class="px-4 py-3 text-center"><div class="grid grid-cols-4 gap-2 w-40 mx-auto items-center">${slotSecar}<button onclick="abrirDossie('${a.id}')" class="w-8 h-8 rounded-full flex items-center justify-center text-blue-500 bg-blue-50 hover:bg-blue-100 transition shadow-sm border border-blue-100"><i class="fas fa-clipboard-list text-xs"></i></button><button onclick="abrirModalEditar('${a.id}')" class="w-8 h-8 rounded-full flex items-center justify-center text-gray-400 bg-white hover:text-slate-800 hover:bg-gray-100 transition shadow-sm border border-gray-100"><i class="fas fa-pen text-xs"></i></button><button onclick="abrirModalExcluir('${a.id}')" class="w-8 h-8 rounded-full flex items-center justify-center text-red-300 bg-white hover:text-red-600 hover:bg-red-50 transition shadow-sm border border-gray-100"><i class="fas fa-trash text-xs"></i></button></div></td></tr>`;
            });
            document.getElementById('sem-resultados').classList.toggle('hidden', count > 0);
        }

        let chartStatus, chartNasc;
        function renderCharts(lact, secas, total, bezerros) {
            const ctx1 = document.getElementById('chartStatus');
            if(chartStatus) chartStatus.destroy();
            if(total === 0) { document.getElementById('chart-msg').classList.remove('hidden'); }
            else {
                document.getElementById('chart-msg').classList.add('hidden');
                chartStatus = new Chart(ctx1, { type: 'doughnut', data: { labels: ['Lactação', 'Outros'], datasets: [{ data: [lact, total - lact], backgroundColor: ['#16a34a', '#ef4444'], borderWidth: 0 }] }, options: { responsive: true, maintainAspectRatio: false, cutout: '75%', plugins: { legend: { position: 'right', labels: { boxWidth: 8, font: {size: 10} } } } } });
            }
            const ctx2 = document.getElementById('chartNascimentos');
            if(chartNasc) chartNasc.destroy();
            const meses = Array(12).fill(0);
            bezerros.forEach(b => { if(b.nascimento) meses[new Date(b.nascimento).getMonth()]++; });
            chartNasc = new Chart(ctx2, { type: 'bar', data: { labels: ['J','F','M','A','M','J','J','A','S','O','N','D'], datasets: [{ data: meses, backgroundColor: '#3b82f6', borderRadius: 3 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { grid: { display: false } }, y: { display: false } } } });
        }

        window.exportarDados = async () => {
            if(!window.todosAnimais || window.todosAnimais.length === 0) { const snap = await getDocs(collection(db, 'animais')); window.todosAnimais = []; snap.forEach(d => window.todosAnimais.push(d.data())); }
            if(window.todosAnimais.length === 0) return alert("Nenhum dado.");
            const csv = Papa.unparse(window.todosAnimais, { quotes: false, delimiter: ";" });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", `backup_gado_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link); link.click(); document.body.removeChild(link);
        }

        // --- FUNÇÃO PARA RESTAURAR BACKUP COMPLETO (CSV DO SISTEMA) ---
        window.importarBackupCompleto = () => {
            const f = document.getElementById('fileBackupCompleto').files[0];
            if(!f) return;
            
            if(!confirm("Isso irá adicionar/atualizar os animais listados no arquivo. Continuar?")) {
                document.getElementById('fileBackupCompleto').value = '';
                return;
            }

            document.getElementById('import-status').innerText = "Lendo backup...";
            
            Papa.parse(f, {
                header: true,
                skipEmptyLines: true,
                encoding: "UTF-8",
                complete: async (results) => {
                    document.getElementById('import-status').innerText = `Processando ${results.data.length} registros...`;
                    
                    let batch = writeBatch(db);
                    let count = 0;
                    let totalProcessado = 0;

                    for (let row of results.data) {
                        if (!row.id) continue;
                        
                        Object.keys(row).forEach(key => {
                            if (row[key] === "" || row[key] === null) delete row[key];
                        });

                        const docRef = doc(db, "animais", row.id);
                        batch.set(docRef, row, { merge: true });
                        count++;
                        totalProcessado++;

                        if (count >= 400) {
                            await batch.commit();
                            batch = writeBatch(db);
                            count = 0;
                            document.getElementById('import-status').innerText = `Salvando... (${totalProcessado})`;
                        }
                    }

                    if (count > 0) await batch.commit();
                    
                    document.getElementById('import-status').innerText = "Restauração concluída!";
                    alert(`Backup restaurado com sucesso! ${totalProcessado} animais processados.`);
                    document.getElementById('fileBackupCompleto').value = '';
                    carregarDados();
                },
                error: (err) => { alert("Erro ao ler arquivo: " + err.message); }
            });
        }

        // --- FUNÇÃO PARA IMPORTAR LEGADO ---
        window.importarCSV = (tipo) => {
            const f = document.getElementById(tipo==='FEMEA'?'fileFemea':tipo==='MACHO'?'fileMacho':'fileNasc').files[0];
            if(!f) return;
            document.getElementById('import-status').innerText = "Carregando...";
            Papa.parse(f, {header:false, skipEmptyLines:true, encoding:"UTF-8", complete:async(res)=>{
                for(let r of res.data){
                    if(!r[0]||r[0].length>20||r[0].toLowerCase().includes('id')) continue;
                    let id=r[0].trim().toUpperCase();
                    let d = {id, status:'Ativo'};
                    if(tipo==='FEMEA'){ d.tipo='FEMEA'; d.status_produtivo=r[2]?.toUpperCase().trim(); d.data_evento=corrigirData(r[1]); }
                    else if(tipo==='MACHO'){ d.tipo='MACHO'; d.categoria_manual=r[3]?.toUpperCase().trim(); }
                    else if(tipo==='NASCIMENTO'){ let nid=`BEZ-${id}-${corrigirData(r[1])?.slice(2)}`; await setDoc(doc(db,'animais',nid),{id:nid, tipo:r[3]?.toUpperCase(), nascimento:corrigirData(r[1]), id_mae:id}); continue; }
                    if(d.id) await setDoc(doc(db,'animais',d.id),d,{merge:true});
                }
                document.getElementById('import-status').innerText = "Concluído! Recarregue a página."; 
                carregarDados();
            }});
        }

        // --- FUNÇÃO PARA ZERAR O BANCO DE DADOS ---
        window.zerarBancoDeDados = async () => {
            if (!confirm("⚠️ ATENÇÃO EXTREMA ⚠️\n\nVocê tem certeza que deseja APAGAR TODOS OS DADOS?\n\nEssa ação não pode ser desfeita.")) return;
            const confirmacao = prompt("Para confirmar, digite DELETAR na caixa abaixo:");
            if (confirmacao !== "DELETAR") return alert("Ação cancelada.");

            document.getElementById('import-status').innerText = "Apagando dados... (Não feche)";
            try {
                const snapAnimais = await getDocs(collection(db, "animais"));
                const totalAnimais = snapAnimais.size;
                const deletePromises = [];
                snapAnimais.forEach(documento => { deletePromises.push(deleteDoc(documento.ref)); });
                
                const snapHist = await getDocs(collection(db, "historico"));
                snapHist.forEach(documento => { deletePromises.push(deleteDoc(documento.ref)); });

                await Promise.all(deletePromises);
                
                window.todosAnimais = [];
                window.cronogramaGlobal = [];
                document.getElementById('import-status').innerText = "";
                alert(`Sistema zerado com sucesso!\n${totalAnimais} animais removidos.`);
                carregarDados();
            } catch (e) { console.error(e); alert("Erro ao apagar: " + e.message); }
        }

        // AÇÕES
        window.abrirModalSecagem = (id) => { document.getElementById('lbl-id-vaca-sec').innerText=id; document.getElementById('input-id-secagem').value=id; document.getElementById('input-data-secagem').value=new Date().toISOString().split('T')[0]; document.getElementById('modal-secagem').classList.remove('hidden'); }
        window.confirmarSecagem = async () => { const id=document.getElementById('input-id-secagem').value; const data=document.getElementById('input-data-secagem').value; try{ await setDoc(doc(db,"animais",id),{status_produtivo:"SECA",data_evento:data,data_secagem:data},{merge:true}); await addDoc(collection(db,"historico"),{animal_id:id,evento:"SECAGEM",data,obs:"Via App",created_at:new Date()}); document.getElementById('modal-secagem').classList.add('hidden'); carregarDados(); }catch(e){alert(e.message);} }
        window.abrirModalEditar = (id) => { document.getElementById('edit-id-antigo').value=id; document.getElementById('view-id-antigo').value=id; document.getElementById('edit-id-novo').value=''; document.getElementById('modal-editar').classList.remove('hidden'); }
        window.confirmarEdicao = async () => { const oldId=document.getElementById('edit-id-antigo').value; const newId=document.getElementById('edit-id-novo').value.toUpperCase().trim(); if(!newId||newId===oldId)return alert("Inválido"); if(!confirm("Confirmar troca?"))return; try{ const docRef=doc(db,"animais",oldId); const snap=await getDoc(docRef); if(snap.exists()){ const d=snap.data(); d.id=newId; await setDoc(doc(db,"animais",newId),d); await addDoc(collection(db,"historico"),{animal_id:newId,evento:"TROCA BRINCO",data:new Date().toISOString().split('T')[0],obs:`Antigo: ${oldId}`,created_at:new Date()}); await deleteDoc(docRef); alert("Sucesso!"); document.getElementById('modal-editar').classList.add('hidden'); carregarDados(); } }catch(e){alert(e.message);} }
        window.abrirModalExcluir = (id) => { document.getElementById('lbl-id-excluir').innerText=id; document.getElementById('input-id-excluir').value=id; document.getElementById('modal-excluir').classList.remove('hidden'); }
        window.confirmarExclusao = async () => { const id=document.getElementById('input-id-excluir').value; const mot=document.getElementById('input-motivo-excluir').value; const data=document.getElementById('input-data-excluir').value; const obs=document.getElementById('input-obs-excluir').value; if(!confirm("Confirmar baixa?"))return; try{ await setDoc(doc(db,"animais",id),{status_produtivo:mot,data_saida:data,obs_saida:obs},{merge:true}); await addDoc(collection(db,"historico"),{animal_id:id,evento:"BAIXA - "+mot,data,obs,created_at:new Date()}); document.getElementById('modal-excluir').classList.add('hidden'); carregarDados(); }catch(e){alert(e.message);} }
        window.abrirDossie = async (id) => { document.getElementById('modal-dossie').classList.remove('hidden'); document.getElementById('dossie-id').innerText=id; document.getElementById('dossie-timeline').innerHTML='<p class="text-xs text-gray-400 p-2">Carregando...</p>'; const docSnap=await getDoc(doc(db,"animais",id)); if(docSnap.exists()){ const d=docSnap.data(); document.getElementById('dossie-resumo').innerHTML=`${d.tipo} | Mãe: ${d.id_mae||'?'} | ${calcularIdade(d.nascimento)}`; } const q=query(collection(db,"historico"),where("animal_id","==",id)); const snap=await getDocs(q); let evts=[]; snap.forEach(d=>evts.push(d.data())); if(docSnap.exists()&&docSnap.data().nascimento)evts.push({evento:'NASCIMENTO',data:docSnap.data().nascimento,obs:'Registro'}); evts.sort((a,b)=>new Date(b.data)-new Date(a.data)); const tl=document.getElementById('dossie-timeline'); tl.innerHTML=''; evts.forEach(e=>{ let color='bg-gray-300'; if(e.evento.includes('PARTO')||e.evento.includes('NASCIMENTO'))color='bg-blue-400'; if(e.evento.includes('SECAGEM')||e.evento.includes('BAIXA'))color='bg-red-400'; tl.innerHTML+=`<div class="relative pl-6 pb-6 border-l border-gray-100 last:pb-0"><div class="absolute -left-[5px] top-1 w-2.5 h-2.5 rounded-full ${color} ring-2 ring-white"></div><p class="text-[10px] font-bold text-gray-400 uppercase">${formatarDataBr(e.data)}</p><p class="text-sm font-bold text-slate-700">${e.evento}</p><p class="text-xs text-gray-500 bg-white p-2 rounded border border-gray-100 mt-1 shadow-sm">${e.obs||''}</p></div>`; }); }
        window.fecharDossie = () => document.getElementById('modal-dossie').classList.add('hidden');
        window.salvarOcorrencia = async () => { const id=document.getElementById('dossie-id').innerText; const data=document.getElementById('dossie-nova-data').value||new Date().toISOString().split('T')[0]; const obs=document.getElementById('dossie-nova-obs').value; if(!obs)return; try{ await addDoc(collection(db,"historico"),{animal_id:id,evento:"OCORRÊNCIA",data,obs,created_at:new Date()}); document.getElementById('dossie-nova-obs').value=''; abrirDossie(id); }catch(e){alert(e.message);} }
        document.getElementById('formNascimento').addEventListener('submit', async (e) => { e.preventDefault(); const idBez=document.getElementById('cad-idBezerro').value.toUpperCase(); const idMae=document.getElementById('cad-idMae').value.toUpperCase(); const data=document.getElementById('cad-data').value; const sexo=document.getElementById('cad-sexo').value; try{ await setDoc(doc(db,"animais",idBez),{id:idBez,tipo:sexo,nascimento:data,id_mae:idMae,status:'Ativo'}); await setDoc(doc(db,"animais",idMae),{id:idMae,status_produtivo:'LACTAÇÃO',data_evento:data},{merge:true}); await addDoc(collection(db,"historico"),{animal_id:idMae,evento:"PARTO",data,obs:`Pariu ${idBez}`,created_at:new Date()}); alert('Parto Registrado!'); document.getElementById('formNascimento').reset(); }catch(e){alert(e.message);} });
        document.getElementById('formAdulto').addEventListener('submit', async (e) => { e.preventDefault(); const id=document.getElementById('adulto-id').value.toUpperCase().trim(); const data=document.getElementById('adulto-data').value; const sexo=document.getElementById('adulto-sexo').value; const status=document.getElementById('adulto-status').value; const obs=document.getElementById('adulto-obs').value; try{ await setDoc(doc(db,"animais",id),{id:id,tipo:sexo,status_produtivo:status,data_evento:data,status:'Ativo',categoria_manual:'ADULTO'},{merge:true}); await addDoc(collection(db,"historico"),{animal_id:id,evento:"CADASTRO/COMPRA",data:data,obs:obs||"Cadastro Avulso",created_at:new Date()}); alert('Cadastrado!'); document.getElementById('formAdulto').reset(); }catch(e){alert(e.message);} });

        function calcularMeses(d) { return (new Date()-new Date(d))/2629746000; }
        function calcularIdade(d) { if(!d)return'-'; const m=Math.floor(calcularMeses(d)); return m<12?m+"m":Math.floor(m/12)+"a"; }
        function formatarDataBr(d) { if(!d)return'-'; const p=d.split('-'); return `${p[2]}/${p[1]}/${p[0].slice(2)}`; }
        function corrigirData(s){ if(!s)return null; let p=s.split('/'); if(p.length!==3)return null; let y=parseInt(p[2]); if(y<100)y+=2000; return `${y}-${p[1].padStart(2,'0')}-${p[0].padStart(2,'0')}`; }

        nav('dashboard');
    </script>
</body>
</html>
