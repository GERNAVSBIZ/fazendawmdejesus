<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Sistema Gado Pro - Prontuário Eletrônico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-slate-100 min-h-screen flex flex-col font-sans">

    <nav class="bg-slate-900 text-white p-4 shadow-lg sticky top-0 z-40">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <h1 class="text-xl font-bold tracking-wider"><i class="fas fa-cow mr-2"></i>GADO PRO <span class="text-xs text-gray-400">v5.0 (Dossiê)</span></h1>
            <div class="flex flex-wrap justify-center gap-2">
                <button onclick="nav('dashboard')" class="px-3 py-2 rounded hover:bg-slate-700 transition"><i class="fas fa-chart-pie mr-1"></i> Painel</button>
                <button onclick="nav('cadastro')" class="px-3 py-2 rounded hover:bg-slate-700 transition"><i class="fas fa-plus-circle mr-1"></i> Nascimento</button>
                <button onclick="nav('lista')" class="px-3 py-2 rounded hover:bg-slate-700 transition"><i class="fas fa-list mr-1"></i> Rebanho</button>
                <button onclick="nav('config')" class="px-3 py-2 rounded bg-blue-900 hover:bg-blue-800 transition"><i class="fas fa-file-import mr-1"></i> Importar</button>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto p-4 md:p-6 w-full flex-grow relative">
        
        <div id="modal-secagem" class="hidden fixed inset-0 bg-black bg-opacity-60 z-[60] flex items-center justify-center p-4 backdrop-blur-sm">
            <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-md border-t-4 border-red-500">
                <h3 class="text-xl font-bold text-slate-800 mb-4">Secar Vaca <span id="lbl-id-vaca-sec" class="text-red-600"></span></h3>
                <input type="hidden" id="input-id-secagem">
                <div class="mb-4">
                    <label class="block text-sm font-bold mb-1">Data da Secagem</label>
                    <input type="date" id="input-data-secagem" class="w-full border p-2 rounded">
                </div>
                <div class="flex justify-end gap-2">
                    <button onclick="document.getElementById('modal-secagem').classList.add('hidden')" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded">Cancelar</button>
                    <button onclick="confirmarSecagem()" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 font-bold">Confirmar</button>
                </div>
            </div>
        </div>

        <div id="modal-dossie" class="hidden fixed inset-0 bg-slate-900 bg-opacity-80 z-[70] flex items-start justify-center p-4 overflow-y-auto backdrop-blur-sm">
            <div class="bg-white rounded-lg shadow-2xl w-full max-w-3xl mt-10 mb-10 overflow-hidden relative">
                <div class="bg-slate-800 p-6 text-white flex justify-between items-start">
                    <div>
                        <h2 class="text-3xl font-bold flex items-center gap-2">
                            <i class="fas fa-id-badge text-yellow-400"></i> 
                            <span id="dossie-id">---</span>
                        </h2>
                        <div class="mt-2 text-slate-300 text-sm flex gap-4" id="dossie-resumo">
                            </div>
                    </div>
                    <button onclick="fecharDossie()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
                </div>

                <div class="p-6 grid grid-cols-1 md:grid-cols-3 gap-6">
                    
                    <div class="md:col-span-1 space-y-4">
                        <div class="bg-blue-50 p-4 rounded border border-blue-200">
                            <h4 class="font-bold text-blue-800 mb-2"><i class="fas fa-pen mr-2"></i>Nova Ocorrência</h4>
                            <p class="text-xs text-blue-600 mb-3">Registre vacinas, doenças, manejos ou acidentes.</p>
                            
                            <label class="block text-xs font-bold text-gray-600 uppercase">Data</label>
                            <input type="date" id="dossie-nova-data" class="w-full border p-2 rounded mb-3 text-sm">
                            
                            <label class="block text-xs font-bold text-gray-600 uppercase">O que houve?</label>
                            <textarea id="dossie-nova-obs" class="w-full border p-2 rounded mb-3 text-sm h-24" placeholder="Ex: Aplicado remedio carrapato..."></textarea>
                            
                            <button onclick="salvarOcorrencia()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded text-sm shadow">
                                SALVAR NO HISTÓRICO
                            </button>
                        </div>
                    </div>

                    <div class="md:col-span-2">
                        <h3 class="font-bold text-slate-700 mb-4 border-b pb-2">Linha do Tempo (Histórico Completo)</h3>
                        <div class="overflow-y-auto max-h-[400px] pr-2 space-y-3" id="dossie-timeline">
                            <p class="text-center text-gray-400 py-4">Carregando histórico...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="tela-dashboard" class="space-y-6 animate-fade">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white p-5 rounded shadow border-l-4 border-slate-700">
                    <div class="text-gray-500 text-xs font-bold uppercase">Total Animais</div>
                    <div class="text-3xl font-extrabold text-slate-800" id="kpi-total">0</div>
                </div>
                <div class="bg-white p-5 rounded shadow border-l-4 border-green-500">
                    <div class="text-gray-500 text-xs font-bold uppercase">Em Lactação</div>
                    <div class="text-3xl font-extrabold text-green-600" id="kpi-lactacao">0</div>
                </div>
                <div class="bg-white p-5 rounded shadow border-l-4 border-orange-500">
                    <div class="text-gray-500 text-xs font-bold uppercase">Bezerros (< 1 ano)</div>
                    <div class="text-3xl font-extrabold text-orange-500" id="kpi-bezerros">0</div>
                </div>
                <div class="bg-white p-5 rounded shadow border-l-4 border-red-500">
                    <div class="text-gray-500 text-xs font-bold uppercase">Vacas Secas</div>
                    <div class="text-3xl font-extrabold text-red-600" id="kpi-secas">0</div>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white p-4 rounded shadow">
                    <h3 class="font-bold text-gray-700 mb-2 border-b pb-2">Status do Rebanho</h3>
                    <div class="h-64 flex justify-center"><canvas id="chartStatus"></canvas></div>
                </div>
                <div class="bg-white p-4 rounded shadow border-t-4 border-yellow-400 overflow-y-auto h-80">
                    <h3 class="font-bold text-yellow-800 mb-2"><i class="fas fa-exclamation-triangle mr-2"></i>Lactação Prolongada (>300 dias)</h3>
                    <table class="w-full text-sm text-left">
                        <thead class="bg-yellow-50 text-yellow-900 sticky top-0"><tr><th>Vaca</th><th>Dias</th><th>Ação</th></tr></thead>
                        <tbody id="lista-alertas"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="tela-cadastro" class="hidden max-w-2xl mx-auto bg-white rounded shadow-lg p-8">
            <h2 class="text-2xl font-bold mb-6 text-slate-800">Registrar Nascimento</h2>
            <form id="formNascimento" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">ID Bezerro(a)</label>
                        <input type="text" id="cad-idBezerro" class="w-full border p-3 rounded" placeholder="Ex: 501" required>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Data Nascimento</label>
                        <input type="date" id="cad-data" class="w-full border p-3 rounded" required>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Sexo</label>
                        <select id="cad-sexo" class="w-full border p-3 rounded">
                            <option value="MACHO">Macho</option>
                            <option value="FEMEA">Fêmea</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">ID da Mãe</label>
                        <input type="text" id="cad-idMae" class="w-full border p-3 rounded" placeholder="Ex: 009" required>
                    </div>
                </div>
                <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded shadow">SALVAR</button>
            </form>
        </div>

        <div id="tela-lista" class="hidden space-y-4">
            <div class="flex justify-between items-center bg-white p-4 rounded shadow">
                <h2 class="text-xl font-bold text-slate-700">Rebanho</h2>
                <input type="text" id="buscaLista" onkeyup="filtrarLista()" placeholder="Buscar..." class="border p-2 rounded w-64">
            </div>
            <div class="bg-white rounded shadow overflow-hidden">
                <div class="overflow-x-auto max-h-[70vh]">
                    <table class="w-full text-left text-sm">
                        <thead class="bg-slate-100 uppercase font-bold text-gray-600 sticky top-0">
                            <tr>
                                <th class="p-3">ID</th>
                                <th class="p-3">Cat.</th>
                                <th class="p-3">Status</th>
                                <th class="p-3">Ref.</th>
                                <th class="p-3 text-center">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-lista" class="divide-y"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="tela-config" class="hidden max-w-4xl mx-auto space-y-6">
            <div class="bg-blue-50 border-l-4 border-blue-600 p-4"><h3 class="font-bold text-blue-800">Importação de Dados</h3><p>Use apenas para carga inicial.</p></div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-white p-4 rounded shadow text-center border-t-4 border-pink-500">
                    <h4 class="font-bold">RG FÊMEA</h4>
                    <input type="file" id="fileFemea" class="block w-full text-xs mt-2" accept=".csv">
                    <button onclick="importarCSV('FEMEA')" class="mt-2 w-full bg-slate-800 text-white text-xs py-2 rounded">PROCESSAR</button>
                </div>
                <div class="bg-white p-4 rounded shadow text-center border-t-4 border-blue-500">
                    <h4 class="font-bold">RG MACHO</h4>
                    <input type="file" id="fileMacho" class="block w-full text-xs mt-2" accept=".csv">
                    <button onclick="importarCSV('MACHO')" class="mt-2 w-full bg-slate-800 text-white text-xs py-2 rounded">PROCESSAR</button>
                </div>
                <div class="bg-white p-4 rounded shadow text-center border-t-4 border-green-500">
                    <h4 class="font-bold">NASCIMENTO</h4>
                    <input type="file" id="fileNasc" class="block w-full text-xs mt-2" accept=".csv">
                    <button onclick="importarCSV('NASCIMENTO')" class="mt-2 w-full bg-slate-800 text-white text-xs py-2 rounded">PROCESSAR</button>
                </div>
            </div>
            <div class="bg-slate-800 text-green-400 p-4 rounded font-mono text-xs h-32 overflow-y-auto" id="console-log">> Pronto.</div>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, doc, writeBatch, getDocs, setDoc, addDoc, query, where, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- CREDENCIAIS ---
        const firebaseConfig = {
            apiKey: "AIzaSyDT93mKi2kTXKLxdQngup6D-czdu9_vTYk",
            authDomain: "registro-animais.firebaseapp.com",
            projectId: "registro-animais",
            storageBucket: "registro-animais.firebasestorage.app",
            messagingSenderId: "343289114136",
            appId: "1:343289114136:web:d98ed164d8bbd3f7b9dd6d"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- NAVEGAÇÃO ---
        window.nav = (tela) => {
            ['dashboard', 'cadastro', 'lista', 'config'].forEach(t => document.getElementById('tela-' + t).classList.add('hidden'));
            document.getElementById('tela-' + tela).classList.remove('hidden');
            if(tela === 'dashboard' || tela === 'lista') carregarDados();
        }

        // --- MODAL SECAGEM ---
        window.abrirModalSecagem = (id) => {
            document.getElementById('lbl-id-vaca-sec').innerText = id;
            document.getElementById('input-id-secagem').value = id;
            document.getElementById('input-data-secagem').value = new Date().toISOString().split('T')[0];
            document.getElementById('modal-secagem').classList.remove('hidden');
        }
        window.confirmarSecagem = async () => {
            const id = document.getElementById('input-id-secagem').value;
            const data = document.getElementById('input-data-secagem').value;
            try {
                await setDoc(doc(db, "animais", id), { status_produtivo: "SECA", data_evento: data, data_secagem: data }, { merge: true });
                await addDoc(collection(db, "historico"), { animal_id: id, evento: "SECAGEM", data: data, obs: "Ciclo encerrado", created_at: new Date() });
                alert("Secagem registrada!");
                document.getElementById('modal-secagem').classList.add('hidden');
                carregarDados();
            } catch(e) { alert("Erro: " + e.message); }
        }

        // --- MODAL DOSSIÊ (O CORAÇÃO DO SISTEMA AGORA) ---
        window.abrirDossie = async (id) => {
            // 1. Prepara UI
            const modal = document.getElementById('modal-dossie');
            const timeline = document.getElementById('dossie-timeline');
            document.getElementById('dossie-id').innerText = id;
            timeline.innerHTML = '<p class="text-center py-4 text-gray-400">Carregando ficha...</p>';
            document.getElementById('dossie-nova-data').value = new Date().toISOString().split('T')[0];
            document.getElementById('dossie-nova-obs').value = '';
            
            modal.classList.remove('hidden');

            try {
                // 2. Pega Dados do Animal
                const docSnap = await getDoc(doc(db, "animais", id));
                if (docSnap.exists()) {
                    const d = docSnap.data();
                    let idade = d.nascimento ? calcularIdade(d.nascimento) : 'Desconhecida';
                    let htmlResumo = `
                        <div><strong class="text-gray-400 uppercase text-xs">Tipo</strong><br>${d.tipo}</div>
                        <div><strong class="text-gray-400 uppercase text-xs">Status</strong><br>${d.status_produtivo || d.status || '-'}</div>
                        <div><strong class="text-gray-400 uppercase text-xs">Mãe</strong><br>${d.id_mae || '-'}</div>
                        <div><strong class="text-gray-400 uppercase text-xs">Idade</strong><br>${idade}</div>
                    `;
                    document.getElementById('dossie-resumo').innerHTML = htmlResumo;
                }

                // 3. Pega Histórico (Query simples, ordenação no JS)
                const q = query(collection(db, "historico"), where("animal_id", "==", id));
                const historySnap = await getDocs(q);
                let eventos = [];
                historySnap.forEach(doc => eventos.push(doc.data()));

                // Adiciona o nascimento do próprio cadastro como evento se não tiver no histórico
                if (docSnap.exists() && docSnap.data().nascimento) {
                    eventos.push({ evento: 'NASCIMENTO (Registro)', data: docSnap.data().nascimento, obs: 'Cadastro Original' });
                }

                // Ordena Cronologicamente (Mais novo primeiro)
                eventos.sort((a,b) => new Date(b.data) - new Date(a.data));

                // 4. Renderiza Timeline
                timeline.innerHTML = '';
                if(eventos.length === 0) timeline.innerHTML = '<p class="text-gray-500 text-sm italic">Nenhum histórico registrado.</p>';
                
                eventos.forEach(evt => {
                    let icon = 'fa-circle';
                    let color = 'bg-gray-100 border-gray-300';
                    let textColor = 'text-gray-700';

                    if(evt.evento.includes('PARTO')) { icon = 'fa-baby'; color = 'bg-green-50 border-green-200'; textColor = 'text-green-800'; }
                    else if(evt.evento.includes('SECAGEM')) { icon = 'fa-ban'; color = 'bg-red-50 border-red-200'; textColor = 'text-red-800'; }
                    else if(evt.evento.includes('OCORRÊNCIA')) { icon = 'fa-notes-medical'; color = 'bg-blue-50 border-blue-200'; textColor = 'text-blue-800'; }
                    else if(evt.evento.includes('NASCIMENTO')) { icon = 'fa-star'; color = 'bg-yellow-50 border-yellow-200'; textColor = 'text-yellow-800'; }

                    timeline.innerHTML += `
                        <div class="flex gap-4">
                            <div class="flex flex-col items-center">
                                <div class="w-8 h-8 rounded-full flex items-center justify-center ${color} border shrink-0">
                                    <i class="fas ${icon} ${textColor} text-xs"></i>
                                </div>
                                <div class="h-full w-px bg-gray-200 my-1"></div>
                            </div>
                            <div class="pb-6">
                                <p class="text-xs font-bold text-gray-500 uppercase mb-1">${formatarDataBr(evt.data)}</p>
                                <div class="bg-white p-3 rounded shadow-sm border border-gray-100 w-full">
                                    <h4 class="font-bold text-sm ${textColor}">${evt.evento}</h4>
                                    <p class="text-sm text-gray-600 mt-1">${evt.obs || ''}</p>
                                </div>
                            </div>
                        </div>
                    `;
                });

            } catch(e) { console.error(e); }
        }

        window.fecharDossie = () => document.getElementById('modal-dossie').classList.add('hidden');

        // Salvar Nota Avulsa
        window.salvarOcorrencia = async () => {
            const id = document.getElementById('dossie-id').innerText;
            const data = document.getElementById('dossie-nova-data').value;
            const obs = document.getElementById('dossie-nova-obs').value;

            if(!obs) return alert('Digite a observação.');

            try {
                await addDoc(collection(db, "historico"), {
                    animal_id: id,
                    evento: "OCORRÊNCIA", // Tipo genérico
                    data: data,
                    obs: obs,
                    created_at: new Date()
                });
                // Recarrega apenas a timeline
                abrirDossie(id);
            } catch (e) { alert("Erro ao salvar: " + e.message); }
        }

        // --- CADASTRO E LISTA ---
        document.getElementById('formNascimento').addEventListener('submit', async (e) => {
            e.preventDefault();
            const idBez = document.getElementById('cad-idBezerro').value.toUpperCase();
            const idMae = document.getElementById('cad-idMae').value.toUpperCase();
            const data = document.getElementById('cad-data').value;
            const sexo = document.getElementById('cad-sexo').value;
            try {
                await setDoc(doc(db, "animais", idBez), { id: idBez, tipo: sexo, nascimento: data, id_mae: idMae, status: 'Ativo' });
                await setDoc(doc(db, "animais", idMae), { id: idMae, status_produtivo: 'LACTAÇÃO', data_evento: data }, { merge: true });
                await addDoc(collection(db, "historico"), { animal_id: idMae, evento: "PARTO", data: data, obs: `Pariu ${idBez}`, created_at: new Date() });
                alert('Salvo!'); document.getElementById('formNascimento').reset();
            } catch(err) { alert(err.message); }
        });

        async function carregarDados() {
            const snap = await getDocs(collection(db, 'animais'));
            let animais = []; snap.forEach(d => animais.push(d.data()));
            
            // KPIs
            const lactacao = animais.filter(a => a.status_produtivo === 'LACTAÇÃO');
            const secas = animais.filter(a => a.status_produtivo === 'SECA');
            const bezerros = animais.filter(a => a.nascimento && calcularMeses(a.nascimento) < 12);
            
            document.getElementById('kpi-total').innerText = animais.length;
            document.getElementById('kpi-lactacao').innerText = lactacao.length;
            document.getElementById('kpi-secas').innerText = secas.length;
            document.getElementById('kpi-bezerros').innerText = bezerros.length;

            // Lista
            const tbody = document.getElementById('tbody-lista'); tbody.innerHTML = '';
            const alertas = []; const hoje = new Date();

            animais.slice(0, 200).forEach(a => {
                let stStyle = 'bg-gray-100 text-gray-500';
                let btnSecar = '';
                
                if(a.status_produtivo === 'LACTAÇÃO') {
                    stStyle = 'bg-green-100 text-green-700 font-bold';
                    btnSecar = `<button onclick="abrirModalSecagem('${a.id}')" class="text-red-500 hover:bg-red-50 p-2 rounded border border-red-200" title="Secar"><i class="fas fa-ban"></i></button>`;
                    if(a.data_evento) {
                        const dias = Math.floor((hoje - new Date(a.data_evento))/86400000);
                        if(dias>300) alertas.push({id:a.id, dias});
                    }
                }
                
                tbody.innerHTML += `
                    <tr class="hover:bg-slate-50 border-b">
                        <td class="p-3 font-bold">${a.id}</td>
                        <td class="p-3 text-xs">${a.tipo}</td>
                        <td class="p-3"><span class="px-2 py-1 rounded text-xs ${stStyle}">${a.status_produtivo || '-'}</span></td>
                        <td class="p-3 text-xs text-gray-500">${formatarDataBr(a.data_evento || a.nascimento)}</td>
                        <td class="p-3 text-center flex justify-center gap-2">
                            ${btnSecar}
                            <button onclick="abrirDossie('${a.id}')" class="bg-blue-600 text-white p-2 rounded hover:bg-blue-700 shadow" title="Abrir Dossiê"><i class="fas fa-address-card"></i></button>
                        </td>
                    </tr>`;
            });

            // Alertas
            const elAlertas = document.getElementById('lista-alertas'); elAlertas.innerHTML = '';
            alertas.forEach(al => elAlertas.innerHTML += `<tr class="border-b"><td class="p-2 font-bold">${al.id}</td><td class="p-2 text-red-600">${al.dias}d</td><td class="p-2"><button onclick="abrirModalSecagem('${al.id}')" class="bg-red-600 text-white px-2 py-1 rounded text-xs">Secar</button></td></tr>`);
            
            // Gráfico
            if(window.chartStatus) window.chartStatus.destroy();
            window.chartStatus = new Chart(document.getElementById('chartStatus'), { type: 'doughnut', data: { labels: ['Lactação', 'Secas', 'Outros'], datasets: [{ data: [lactacao.length, secas.length, animais.length - lactacao.length - secas.length], backgroundColor: ['#16a34a', '#dc2626', '#cbd5e1'] }] } });
        }

        // Helpers
        function calcularMeses(d) { return (new Date() - new Date(d)) / 2629746000; }
        function calcularIdade(d) { const m = Math.floor(calcularMeses(d)); return m < 12 ? m + " meses" : Math.floor(m/12) + " anos"; }
        function formatarDataBr(dt) { if(!dt) return '-'; const p=dt.split('-'); return `${p[2]}/${p[1]}/${p[0]}`; }
        window.filtrarLista = () => carregarDados();
        
        // Importação (Código Compactado)
        window.importarCSV = (tipo) => {
            const f = document.getElementById(tipo==='FEMEA'?'fileFemea':tipo==='MACHO'?'fileMacho':'fileNasc').files[0];
            if(!f) return alert('Selecione arquivo');
            Papa.parse(f, {header:false, skipEmptyLines:true, encoding:"ISO-8859-1", complete:async(res)=>{
                const batch=writeBatch(db);
                for(let r of res.data){
                    if(!r[0]||r[0].length>20||r[0].toLowerCase().includes('id'))continue;
                    let id=r[0].trim().toUpperCase();
                    if(tipo==='FEMEA') await setDoc(doc(db,'animais',id),{id,tipo:'FEMEA',status_produtivo:r[2]?.toUpperCase().trim(),data_evento:corrigirData(r[1])},{merge:true});
                    else if(tipo==='MACHO') await setDoc(doc(db,'animais',id),{id,tipo:'MACHO',status:'Ativo'},{merge:true});
                    else if(tipo==='NASCIMENTO') await setDoc(doc(db,'animais',`BEZ-${id}-${corrigirData(r[1])?.slice(2)}`),{id:`BEZ-${id}`,tipo:r[3],nascimento:corrigirData(r[1]),id_mae:id});
                }
                alert('Importado!');
            }});
        }
        function corrigirData(s) { if(!s)return null; let p=s.split('/'); if(p.length!==3)return null; let y=parseInt(p[2]); if(y<100)y+=2000; return `${y}-${p[1].padStart(2,'0')}-${p[0].padStart(2,'0')}`; }

        nav('dashboard');
    </script>
</body>
</html>
